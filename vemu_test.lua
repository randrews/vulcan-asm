dofile('vemu.lua')

local cpu = CPU.new()
assert(cpu.stack[0] == 0)
assert(cpu.stack[2047] == 0)
assert(cpu.stack[2048] == nil)
assert(cpu.mem[0] == 0)
assert(cpu.mem[131071] == 0)
assert(cpu.mem[131072] == nil)
assert(cpu.call == 0)
assert(cpu.data == 2047)

local cpu = CPU.new()
cpu:push_data(37)
cpu:push_data(45)
assert(cpu.stack[0] == 37)
assert(cpu.stack[1] == 45)
assert(cpu.call == 0)
assert(cpu.data == 1)

local cpu = CPU.new()
cpu:push_call(37)
cpu:push_call(45)
assert(cpu.stack[2047] == 37)
assert(cpu.stack[2046] == 45)
assert(cpu.call == 2046)
assert(cpu.data == 2047)

local cpu = CPU.new()
cpu:push_data(47)
cpu:push_data(32)
assert(cpu:pop_data() == 32)
assert(cpu:pop_data() == 47)
assert(cpu.data == 2047)

local cpu = CPU.new()
cpu:poke(37, 45)
assert(cpu.mem[37] == 45)
assert(cpu:peek(37) == 45)

local cpu = CPU.new()
cpu:poke(0xffffff, 47)
assert(cpu.mem[0x01ffff] == 47)
assert(cpu:peek(0xffffff) == 47)
assert(cpu:peek(0x01ffff) == 47)
